{"version":3,"file":"js/495.7446dcac.js","mappings":"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","sources":["webpack://frontend/./src/views/user/UserProfile.vue","webpack://frontend/./src/views/user/UserProfile.vue?d130","webpack://frontend/./node_modules/@ant-design/icons-svg/es/asn/UploadOutlined.js","webpack://frontend/./node_modules/@ant-design/icons-vue/es/icons/UploadOutlined.js"],"sourcesContent":["<template>\n  <div class=\"user-profile\">\n    <div class=\"container\">\n      <div class=\"user-profile-header\">\n        <h1>个人信息</h1>\n        <p>管理您的账号信息</p>\n      </div>\n      \n      <div class=\"profile-card\">\n        <a-form\n          :model=\"formData\"\n          :rules=\"rules\"\n          layout=\"vertical\"\n          @finish=\"handleSubmit\"\n        >\n          <div class=\"avatar-section\">\n            <a-avatar :src=\"avatarUrl\" :size=\"100\" />\n            <div class=\"avatar-upload\">\n              <a-upload\n                name=\"avatar\"\n                :show-upload-list=\"false\"\n                :before-upload=\"beforeUpload\"\n                @change=\"handleAvatarChange\"\n              >\n                <a-button>\n                  <template #icon><upload-outlined /></template>\n                  更换头像\n                </a-button>\n              </a-upload>\n            </div>\n          </div>\n          \n          <a-form-item label=\"用户名\" name=\"username\">\n            <a-input v-model:value=\"formData.username\" disabled />\n          </a-form-item>\n          \n          <a-form-item label=\"邮箱\" name=\"email\">\n            <a-input v-model:value=\"formData.email\" />\n          </a-form-item>\n          \n          <a-form-item label=\"旧密码\" name=\"oldPassword\">\n            <a-input-password v-model:value=\"formData.oldPassword\" placeholder=\"留空表示不修改密码\" />\n          </a-form-item>\n          \n          <a-form-item label=\"新密码\" name=\"newPassword\">\n            <a-input-password v-model:value=\"formData.newPassword\" placeholder=\"留空表示不修改密码\" />\n          </a-form-item>\n          \n          <a-form-item label=\"确认新密码\" name=\"confirmPassword\">\n            <a-input-password v-model:value=\"formData.confirmPassword\" placeholder=\"留空表示不修改密码\" />\n          </a-form-item>\n          \n          <a-form-item>\n            <a-button type=\"primary\" html-type=\"submit\" :loading=\"loading\">\n              保存修改\n            </a-button>\n          </a-form-item>\n        </a-form>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue'\nimport { message } from 'ant-design-vue'\nimport { UploadOutlined } from '@ant-design/icons-vue'\nimport { useUserStore } from '../../stores/user'\nimport api from '../../api'\n\nconst userStore = useUserStore()\nconst loading = ref(false)\nconst avatarUrl = ref(userStore.userInfo.avatar || '/avatar-default.png')\n\n// 表单数据\nconst formData = reactive({\n  username: userStore.userInfo.username || '',\n  email: userStore.userInfo.email || '',\n  oldPassword: '',\n  newPassword: '',\n  confirmPassword: ''\n})\n\n// 表单验证规则\nconst rules = {\n  email: [\n    { required: true, message: '请输入邮箱', trigger: 'blur' },\n    { type: 'email', message: '请输入有效的邮箱地址', trigger: 'blur' }\n  ],\n  newPassword: [\n    { \n      validator: (_, value) => {\n        if (!value || value.length === 0) return Promise.resolve()\n        if (value.length < 6 || value.length > 20) {\n          return Promise.reject(new Error('密码长度必须在6-20个字符之间'))\n        }\n        return Promise.resolve()\n      },\n      trigger: 'blur'\n    }\n  ],\n  confirmPassword: [\n    {\n      validator: (_, value) => {\n        if (!formData.newPassword || formData.newPassword.length === 0) return Promise.resolve()\n        if (value !== formData.newPassword) {\n          return Promise.reject(new Error('两次输入的密码不一致'))\n        }\n        return Promise.resolve()\n      },\n      trigger: 'blur'\n    }\n  ],\n  oldPassword: [\n    {\n      validator: (_, value) => {\n        if (!formData.newPassword || formData.newPassword.length === 0) return Promise.resolve()\n        if (!value || value.length === 0) {\n          return Promise.reject(new Error('修改密码时必须输入旧密码'))\n        }\n        return Promise.resolve()\n      },\n      trigger: 'blur'\n    }\n  ]\n}\n\n// 上传头像前的处理\nconst beforeUpload = (file) => {\n  const isImage = file.type.startsWith('image/')\n  if (!isImage) {\n    message.error('只能上传图片文件!')\n  }\n  \n  const isLt2M = file.size / 1024 / 1024 < 2\n  if (!isLt2M) {\n    message.error('图片大小不能超过2MB!')\n  }\n  \n  return false // 阻止自动上传，改为手动上传\n}\n\n// 处理头像变化\nconst handleAvatarChange = (info) => {\n  if (info.file.status !== 'uploading') {\n    console.log(info.file, info.fileList)\n  }\n  if (info.file.status === 'done') {\n    message.success(`${info.file.name} 上传成功`)\n    // 更新头像URL\n    avatarUrl.value = info.file.response.url\n    formData.avatar = info.file.response.url\n  } else if (info.file.status === 'error') {\n    message.error(`${info.file.name} 上传失败`)\n  }\n}\n\n// 获取用户信息\nconst fetchUserInfo = async () => {\n  try {\n    const res = await api.user.getUserInfo()\n    if (res.code === 200) {\n      formData.username = res.data.username\n      formData.email = res.data.email\n      avatarUrl.value = res.data.avatar || '/avatar-default.png'\n    }\n  } catch (error) {\n    message.error('获取用户信息失败')\n  }\n}\n\n// 提交表单\nconst handleSubmit = async () => {\n  loading.value = true\n  \n  try {\n    // 构建更新数据\n    const updateData = {\n      email: formData.email\n    }\n    \n    // 如果有修改密码\n    if (formData.newPassword && formData.oldPassword) {\n      updateData.oldPassword = formData.oldPassword\n      updateData.newPassword = formData.newPassword\n    }\n    \n    // 如果有上传头像\n    if (formData.avatar) {\n      updateData.avatar = formData.avatar\n    }\n    \n    const res = await api.user.updateUserInfo(updateData)\n    if (res.code === 200) {\n      message.success('个人信息更新成功')\n      // 清空密码字段\n      formData.oldPassword = ''\n      formData.newPassword = ''\n      formData.confirmPassword = ''\n      // 刷新用户信息\n      await userStore.getUserInfo()\n    } else {\n      message.error(res.message || '更新失败')\n    }\n  } catch (error) {\n    message.error('更新失败，请稍后重试')\n  } finally {\n    loading.value = false\n  }\n}\n\nonMounted(() => {\n  fetchUserInfo()\n})\n</script>\n\n<style scoped>\n.user-profile {\n  padding-bottom: 40px;\n}\n\n.user-profile-header {\n  text-align: center;\n  margin-bottom: 32px;\n}\n\n.user-profile-header h1 {\n  font-size: 32px;\n  margin-bottom: 8px;\n  background: var(--primary-gradient);\n  -webkit-background-clip: text;\n  -webkit-text-fill-color: transparent;\n  display: inline-block;\n}\n\n.user-profile-header p {\n  color: var(--text-color-light);\n  font-size: 16px;\n}\n\n.profile-card {\n  background: white;\n  border-radius: var(--border-radius-large);\n  box-shadow: var(--box-shadow);\n  padding: 32px;\n  max-width: 500px;\n  margin: 0 auto;\n}\n\n.avatar-section {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-bottom: 24px;\n}\n\n.avatar-upload {\n  margin-top: 16px;\n}\n</style>\n","import script from \"./UserProfile.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./UserProfile.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./UserProfile.vue?vue&type=style&index=0&id=1916aa0a&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-1916aa0a\"]])\n\nexport default __exports__","// This icon file is generated automatically.\nvar UploadOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z\" } }] }, \"name\": \"upload\", \"theme\": \"outlined\" };\nexport default UploadOutlined;\n","import { createVNode as _createVNode } from \"vue\";\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? Object(arguments[i]) : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport UploadOutlinedSvg from \"@ant-design/icons-svg/es/asn/UploadOutlined\";\nimport AntdIcon from '../components/AntdIcon';\n\nvar UploadOutlined = function UploadOutlined(props, context) {\n  var p = _objectSpread({}, props, context.attrs);\n\n  return _createVNode(AntdIcon, _objectSpread({}, p, {\n    \"icon\": UploadOutlinedSvg\n  }), null);\n};\n\nUploadOutlined.displayName = 'UploadOutlined';\nUploadOutlined.inheritAttrs = false;\nexport default UploadOutlined;"],"names":["userStore","useUserStore","loading","ref","avatarUrl","userInfo","avatar","formData","reactive","username","email","oldPassword","newPassword","confirmPassword","rules","required","message","trigger","type","validator","_","value","length","Promise","reject","Error","resolve","beforeUpload","file","isImage","startsWith","error","isLt2M","size","handleAvatarChange","info","status","console","log","fileList","success","name","response","url","fetchUserInfo","async","res","api","user","getUserInfo","code","data","handleSubmit","updateData","updateUserInfo","onMounted","__exports__","UploadOutlined","_objectSpread","target","i","arguments","source","Object","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","obj","defineProperty","configurable","writable","props","context","p","attrs","_createVNode","AntdIcon","UploadOutlinedSvg","displayName","inheritAttrs"],"sourceRoot":""}