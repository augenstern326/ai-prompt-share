"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[495],{6495:function(e,a,r){r.r(a),r.d(a,{default:function(){return p}});var l=r(6768),s=r(144),o=r(7694),t=r(9735),n=r(4783),u=r(3397);const d={class:"user-profile"},i={class:"container"},c={class:"profile-card"},f={class:"avatar-section"},v={class:"avatar-upload"};var m={__name:"UserProfile",setup(e){const a=(0,n.k)(),r=(0,s.KR)(!1),m=(0,s.KR)(a.userInfo.avatar||"/avatar-default.png"),w=(0,s.Kh)({username:a.userInfo.username||"",email:a.userInfo.email||"",oldPassword:"",newPassword:"",confirmPassword:""}),b={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],newPassword:[{validator:(e,a)=>a&&0!==a.length&&(a.length<6||a.length>20)?Promise.reject(new Error("密码长度必须在6-20个字符之间")):Promise.resolve(),trigger:"blur"}],confirmPassword:[{validator:(e,a)=>w.newPassword&&0!==w.newPassword.length&&a!==w.newPassword?Promise.reject(new Error("两次输入的密码不一致")):Promise.resolve(),trigger:"blur"}],oldPassword:[{validator:(e,a)=>w.newPassword&&0!==w.newPassword.length?a&&0!==a.length?Promise.resolve():Promise.reject(new Error("修改密码时必须输入旧密码")):Promise.resolve(),trigger:"blur"}]},p=e=>{const a=e.type.startsWith("image/");a||o.Ay.error("只能上传图片文件!");const r=e.size/1024/1024<2;return r||o.Ay.error("图片大小不能超过2MB!"),!1},g=e=>{"uploading"!==e.file.status&&console.log(e.file,e.fileList),"done"===e.file.status?(o.Ay.success(`${e.file.name} 上传成功`),m.value=e.file.response.url,w.avatar=e.file.response.url):"error"===e.file.status&&o.Ay.error(`${e.file.name} 上传失败`)},P=async()=>{try{const e=await u["default"].user.getUserInfo();200===e.code&&(w.username=e.data.username,w.email=e.data.email,m.value=e.data.avatar||"/avatar-default.png")}catch(e){o.Ay.error("获取用户信息失败")}},h=async()=>{r.value=!0;try{const e={email:w.email};w.newPassword&&w.oldPassword&&(e.oldPassword=w.oldPassword,e.newPassword=w.newPassword),w.avatar&&(e.avatar=w.avatar);const r=await u["default"].user.updateUserInfo(e);200===r.code?(o.Ay.success("个人信息更新成功"),w.oldPassword="",w.newPassword="",w.confirmPassword="",await a.getUserInfo()):o.Ay.error(r.message||"更新失败")}catch(e){o.Ay.error("更新失败，请稍后重试")}finally{r.value=!1}};return(0,l.sV)((()=>{P()})),(e,a)=>{const o=(0,l.g2)("a-avatar"),n=(0,l.g2)("a-button"),u=(0,l.g2)("a-upload"),P=(0,l.g2)("a-input"),y=(0,l.g2)("a-form-item"),k=(0,l.g2)("a-input-password"),F=(0,l.g2)("a-form");return(0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("div",i,[a[7]||(a[7]=(0,l.Lk)("div",{class:"user-profile-header"},[(0,l.Lk)("h1",null,"个人信息"),(0,l.Lk)("p",null,"管理您的账号信息")],-1)),(0,l.Lk)("div",c,[(0,l.bF)(F,{model:w,rules:b,layout:"vertical",onFinish:h},{default:(0,l.k6)((()=>[(0,l.Lk)("div",f,[(0,l.bF)(o,{src:m.value,size:100},null,8,["src"]),(0,l.Lk)("div",v,[(0,l.bF)(u,{name:"avatar","show-upload-list":!1,"before-upload":p,onChange:g},{default:(0,l.k6)((()=>[(0,l.bF)(n,null,{icon:(0,l.k6)((()=>[(0,l.bF)((0,s.R1)(t.A))])),default:(0,l.k6)((()=>[a[5]||(a[5]=(0,l.eW)(" 更换头像 "))])),_:1})])),_:1})])]),(0,l.bF)(y,{label:"用户名",name:"username"},{default:(0,l.k6)((()=>[(0,l.bF)(P,{value:w.username,"onUpdate:value":a[0]||(a[0]=e=>w.username=e),disabled:""},null,8,["value"])])),_:1}),(0,l.bF)(y,{label:"邮箱",name:"email"},{default:(0,l.k6)((()=>[(0,l.bF)(P,{value:w.email,"onUpdate:value":a[1]||(a[1]=e=>w.email=e)},null,8,["value"])])),_:1}),(0,l.bF)(y,{label:"旧密码",name:"oldPassword"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{value:w.oldPassword,"onUpdate:value":a[2]||(a[2]=e=>w.oldPassword=e),placeholder:"留空表示不修改密码"},null,8,["value"])])),_:1}),(0,l.bF)(y,{label:"新密码",name:"newPassword"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{value:w.newPassword,"onUpdate:value":a[3]||(a[3]=e=>w.newPassword=e),placeholder:"留空表示不修改密码"},null,8,["value"])])),_:1}),(0,l.bF)(y,{label:"确认新密码",name:"confirmPassword"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{value:w.confirmPassword,"onUpdate:value":a[4]||(a[4]=e=>w.confirmPassword=e),placeholder:"留空表示不修改密码"},null,8,["value"])])),_:1}),(0,l.bF)(y,null,{default:(0,l.k6)((()=>[(0,l.bF)(n,{type:"primary","html-type":"submit",loading:r.value},{default:(0,l.k6)((()=>a[6]||(a[6]=[(0,l.eW)(" 保存修改 ")]))),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])])])}}},w=r(1241);const b=(0,w.A)(m,[["__scopeId","data-v-1916aa0a"]]);var p=b},9735:function(e,a,r){r.d(a,{A:function(){return i}});r(8111),r(2489),r(7588);var l=r(6768),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},o=s,t=r(7526);function n(e){for(var a=1;a<arguments.length;a++){var r=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),l.forEach((function(a){u(e,a,r[a])}))}return e}function u(e,a,r){return a in e?Object.defineProperty(e,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[a]=r,e}var d=function(e,a){var r=n({},e,a.attrs);return(0,l.bF)(t.A,n({},r,{icon:o}),null)};d.displayName="UploadOutlined",d.inheritAttrs=!1;var i=d}}]);
//# sourceMappingURL=495.7446dcac.js.map