"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[105],{4105:function(e,t,a){a.r(t),a.d(t,{default:function(){return b}});var l=a(6768),n=a(4232);const r={class:"prompt-edit"},o={key:0};function i(e,t,a,i,u,c){const s=(0,l.g2)("a-input"),d=(0,l.g2)("a-form-item"),f=(0,l.g2)("a-textarea"),m=(0,l.g2)("a-select-option"),p=(0,l.g2)("a-select"),g=(0,l.g2)("upload-outlined"),b=(0,l.g2)("a-upload"),v=(0,l.g2)("a-button"),y=(0,l.g2)("a-form"),h=(0,l.g2)("a-card");return(0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(h,{title:"编辑提示词"},{default:(0,l.k6)((()=>[(0,l.bF)(y,{model:i.formState,rules:i.rules,ref:"formRef",layout:"vertical"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{label:"标题",name:"title"},{default:(0,l.k6)((()=>[(0,l.bF)(s,{value:i.formState.title,"onUpdate:value":t[0]||(t[0]=e=>i.formState.title=e),placeholder:"请输入提示词标题"},null,8,["value"])])),_:1}),(0,l.bF)(d,{label:"内容",name:"content"},{default:(0,l.k6)((()=>[(0,l.bF)(f,{value:i.formState.content,"onUpdate:value":t[1]||(t[1]=e=>i.formState.content=e),placeholder:"请输入提示词内容","auto-size":{minRows:5,maxRows:15}},null,8,["value"])])),_:1}),(0,l.bF)(d,{label:"标签",name:"tagIds"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{value:i.formState.tagIds,"onUpdate:value":t[2]||(t[2]=e=>i.formState.tagIds=e),mode:"multiple",placeholder:"请选择标签",style:{width:"100%"}},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(i.tagList,(e=>((0,l.uX)(),(0,l.Wv)(m,{key:e.id,value:e.id},{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),(0,l.bF)(d,{label:"效果图",name:"imageUrl"},{default:(0,l.k6)((()=>[(0,l.bF)(b,{"file-list":i.fileList,"onUpdate:fileList":t[3]||(t[3]=e=>i.fileList=e),"list-type":"picture-card","before-upload":i.beforeUpload,onChange:i.handleChange},{default:(0,l.k6)((()=>[i.fileList.length<1?((0,l.uX)(),(0,l.CE)("div",o,[(0,l.bF)(g),t[4]||(t[4]=(0,l.Lk)("div",{style:{"margin-top":"8px"}},"上传",-1))])):(0,l.Q3)("",!0)])),_:1},8,["file-list","before-upload","onChange"])])),_:1}),(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(v,{type:"primary",onClick:i.onSubmit},{default:(0,l.k6)((()=>t[5]||(t[5]=[(0,l.eW)("保存")]))),_:1},8,["onClick"]),(0,l.bF)(v,{style:{"margin-left":"10px"},onClick:i.onCancel},{default:(0,l.k6)((()=>t[6]||(t[6]=[(0,l.eW)("取消")]))),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])])),_:1})])}a(4114),a(8111),a(1701);var u=a(144),c=a(1387),s=a(7694),d=a(9735),f=a(3397),m={name:"PromptEditPage",components:{UploadOutlined:d.A},setup(){const e=(0,c.rd)(),t=(0,c.lq)(),a=(0,u.KR)(),n=(0,u.KR)([]),r=(0,u.KR)([]),o=(0,u.Kh)({id:null,title:"",content:"",tagIds:[],imageUrl:""}),i={title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}],tagIds:[{required:!0,message:"请选择至少一个标签",type:"array"}]};(0,l.sV)((async()=>{try{const e=await(0,f.Tn)();n.value=e.data.list;const a=t.params.id;if(a){const e=await(0,f.mK)(a),t=e.data;o.id=t.id,o.title=t.title,o.content=t.content,o.tagIds=t.tags.map((e=>e.id)),o.imageUrl=t.imageUrl,t.imageUrl&&(r.value=[{uid:"-1",name:"image.png",status:"done",url:t.imageUrl}])}}catch(e){s.Ay.error("获取数据失败")}}));const d=e=>{const t=e.type.startsWith("image/");t||s.Ay.error("只能上传图片文件!");const a=e.size/1024/1024<2;return a||s.Ay.error("图片必须小于2MB!"),!1},m=async e=>{if("uploading"!==e.file.status){const a=new FormData;a.append("file",e.file.originFileObj),a.append("directory","prompt");try{const t=await(0,f.QM)(e.file.originFileObj,"prompt");o.imageUrl=t.data.objectName,s.Ay.success("上传成功")}catch(t){s.Ay.error("上传失败")}}},p=()=>{a.value.validate().then((async()=>{try{await(0,f.qj)(o),s.Ay.success("保存成功"),e.push("/prompt/detail/"+o.id)}catch(t){s.Ay.error("保存失败")}})).catch((e=>{console.log("验证失败",e)}))},g=()=>{e.back()};return{formRef:a,formState:o,rules:i,tagList:n,fileList:r,beforeUpload:d,handleChange:m,onSubmit:p,onCancel:g}}},p=a(1241);const g=(0,p.A)(m,[["render",i],["__scopeId","data-v-5a9dfaaa"]]);var b=g},9735:function(e,t,a){a.d(t,{A:function(){return s}});a(8111),a(2489),a(7588);var l=a(6768),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},r=n,o=a(7526);function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},l=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),l.forEach((function(t){u(e,t,a[t])}))}return e}function u(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var c=function(e,t){var a=i({},e,t.attrs);return(0,l.bF)(o.A,i({},a,{icon:r}),null)};c.displayName="UploadOutlined",c.inheritAttrs=!1;var s=c}}]);
//# sourceMappingURL=105.81e442aa.js.map