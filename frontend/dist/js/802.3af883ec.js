"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[802],{3802:function(e,a,t){t.r(a),t.d(a,{default:function(){return k}});t(4114),t(8111),t(1701);var l=t(6768),r=t(4232),n=t(144),u=t(1387),i=t(7694),o=t(9735),s=t(3397);const c={class:"prompt-create"},d={class:"container"},v={class:"prompt-create-header"},p={class:"prompt-create-form"},g={style:{padding:"8px",cursor:"pointer"}},m={key:0},f=["src"];var b={__name:"PromptCreate",setup(e){const a=(0,u.lq)(),t=(0,u.rd)(),b=(0,l.EW)((()=>a.path.includes("/edit/"))),y=(0,l.EW)((()=>b.value?a.params.id:null)),h=(0,n.KR)(!1),k=(0,n.KR)(!1),w=(0,n.KR)([]),F=(0,n.KR)(""),_=(0,n.KR)([]),A=(0,n.KR)(!1),L=(0,n.KR)(""),O=(0,n.KR)(""),I=(0,n.Kh)({title:"",content:"",tagIds:[],imageUrl:""}),P={title:[{required:!0,message:"请输入提示词标题",trigger:"blur"},{max:100,message:"标题长度不能超过100个字符",trigger:"blur"}],content:[{required:!0,message:"请输入提示词内容",trigger:"blur"}],tagIds:[{required:!0,type:"array",min:1,message:"请至少选择一个标签",trigger:"change"}]},R=async()=>{k.value=!0;try{const e=await s["default"].tag.getTagList();200===e.code&&(w.value=e.data.map((e=>({label:e.name,value:e.id}))))}catch(e){console.error("获取标签列表失败",e)}finally{k.value=!1}},U=async()=>{if(F.value)try{const e=await s["default"].tag.createTag({name:F.value,type:1});if(200===e.code){const a=e.data;w.value.push({label:F.value,value:a}),I.tagIds.push(a),F.value="",i.Ay.success("标签创建成功")}}catch(e){i.Ay.error("创建标签失败，请稍后重试")}else i.Ay.warning("请输入标签名称")},x=e=>{I.tagIds=e},C=e=>{const a=e.type.startsWith("image/");a||i.Ay.error("只能上传图片文件!");const t=e.size/1024/1024<2;return t||i.Ay.error("图片大小不能超过2MB!"),!1},j=async e=>{e.url||e.preview||(e.preview=await W(e.originFileObj)),L.value=e.url||e.preview,A.value=!0,O.value=e.name||e.url.substring(e.url.lastIndexOf("/")+1)},K=({fileList:e})=>{_.value=e},W=e=>new Promise(((a,t)=>{const l=new FileReader;l.readAsDataURL(e),l.onload=()=>a(l.result),l.onerror=e=>t(e)})),E=async e=>Promise.resolve(`/uploads/${e.name}`),q=async()=>{if(b.value)try{const e=await s["default"].prompt.getPromptDetail(y.value);if(200===e.code){const{title:a,content:t,imageUrl:l,tags:r}=e.data;I.title=a,I.content=t,I.imageUrl=l,I.tagIds=r.map((e=>e.id)),l&&(_.value=[{uid:"-1",name:l.substring(l.lastIndexOf("/")+1),status:"done",url:l}])}}catch(e){i.Ay.error("获取提示词详情失败"),t.push("/prompt/square")}},V=async()=>{h.value=!0;try{let e;_.value.length>0&&_.value[0].originFileObj&&(I.imageUrl=await E(_.value[0].originFileObj)),e=b.value?await s["default"].prompt.updatePrompt({id:y.value,...I}):await s["default"].prompt.createPrompt(I),200===e.code?(i.Ay.success(b.value?"提示词更新成功":"提示词创建成功"),b.value?t.push(`/prompt/detail/${y.value}`):t.push(`/prompt/detail/${e.data}`)):i.Ay.error(e.message||"操作失败")}catch(e){i.Ay.error("操作失败，请稍后重试")}finally{h.value=!1}},z=()=>{t.back()};return(0,l.sV)((()=>{R(),q()})),(e,a)=>{const t=(0,l.g2)("a-input"),u=(0,l.g2)("a-form-item"),i=(0,l.g2)("a-textarea"),s=(0,l.g2)("a-divider"),y=(0,l.g2)("a-button"),R=(0,l.g2)("a-select"),W=(0,l.g2)("a-upload"),E=(0,l.g2)("a-modal"),q=(0,l.g2)("a-form");return(0,l.uX)(),(0,l.CE)("div",c,[(0,l.Lk)("div",d,[(0,l.Lk)("div",v,[(0,l.Lk)("h1",null,(0,r.v_)(b.value?"编辑提示词":"创建提示词"),1),(0,l.Lk)("p",null,(0,r.v_)(b.value?"修改您的提示词内容和信息":"分享您的AI提示词，帮助更多人创作"),1)]),(0,l.Lk)("div",p,[(0,l.bF)(q,{model:I,rules:P,layout:"vertical",onFinish:V},{default:(0,l.k6)((()=>[(0,l.bF)(u,{label:"标题",name:"title"},{default:(0,l.k6)((()=>[(0,l.bF)(t,{value:I.title,"onUpdate:value":a[0]||(a[0]=e=>I.title=e),placeholder:"请输入提示词标题"},null,8,["value"])])),_:1}),(0,l.bF)(u,{label:"提示词内容",name:"content"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{value:I.content,"onUpdate:value":a[1]||(a[1]=e=>I.content=e),placeholder:"请输入提示词内容",rows:8},null,8,["value"])])),_:1}),(0,l.bF)(u,{label:"标签",name:"tagIds"},{default:(0,l.k6)((()=>[(0,l.bF)(R,{value:I.tagIds,"onUpdate:value":a[3]||(a[3]=e=>I.tagIds=e),mode:"multiple",placeholder:"选择或创建标签",options:w.value,loading:k.value,tokenSeparators:[","],onChange:x},{dropdownRender:(0,l.k6)((({menuNode:e})=>[(0,l.Lk)("div",null,[(0,l.eW)((0,r.v_)(e)+" ",1),(0,l.bF)(s,{style:{margin:"4px 0"}}),(0,l.Lk)("div",g,[(0,l.bF)(t,{value:F.value,"onUpdate:value":a[2]||(a[2]=e=>F.value=e),placeholder:"输入新标签名称",onPressEnter:U},{suffix:(0,l.k6)((()=>[(0,l.bF)(y,{type:"link",onClick:U},{default:(0,l.k6)((()=>a[6]||(a[6]=[(0,l.eW)("添加")]))),_:1})])),_:1},8,["value"])])])])),_:1},8,["value","options","loading"])])),_:1}),(0,l.bF)(u,{label:"效果图片",name:"imageUrl"},{default:(0,l.k6)((()=>[(0,l.bF)(W,{fileList:_.value,"onUpdate:fileList":a[4]||(a[4]=e=>_.value=e),"list-type":"picture-card","before-upload":C,onPreview:j,onChange:K,maxCount:1},{default:(0,l.k6)((()=>[_.value.length<1?((0,l.uX)(),(0,l.CE)("div",m,[(0,l.bF)((0,n.R1)(o.A)),a[7]||(a[7]=(0,l.Lk)("div",{style:{"margin-top":"8px"}},"上传图片",-1))])):(0,l.Q3)("",!0)])),_:1},8,["fileList"]),(0,l.bF)(E,{visible:A.value,title:O.value,footer:null,onCancel:a[5]||(a[5]=e=>A.value=!1)},{default:(0,l.k6)((()=>[(0,l.Lk)("img",{alt:"预览图片",style:{width:"100%"},src:L.value},null,8,f)])),_:1},8,["visible","title"])])),_:1}),(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(y,{type:"primary","html-type":"submit",loading:h.value},{default:(0,l.k6)((()=>[(0,l.eW)((0,r.v_)(b.value?"保存修改":"创建提示词"),1)])),_:1},8,["loading"]),(0,l.bF)(y,{style:{"margin-left":"10px"},onClick:z},{default:(0,l.k6)((()=>a[8]||(a[8]=[(0,l.eW)("取消")]))),_:1})])),_:1})])),_:1},8,["model"])])])])}}},y=t(1241);const h=(0,y.A)(b,[["__scopeId","data-v-5644ae35"]]);var k=h},9735:function(e,a,t){t.d(a,{A:function(){return c}});t(8111),t(2489),t(7588);var l=t(6768),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},n=r,u=t(7526);function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),l.forEach((function(a){o(e,a,t[a])}))}return e}function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var s=function(e,a){var t=i({},e,a.attrs);return(0,l.bF)(u.A,i({},t,{icon:n}),null)};s.displayName="UploadOutlined",s.inheritAttrs=!1;var c=s}}]);
//# sourceMappingURL=802.3af883ec.js.map